<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorator="layout">
<head>
<title>Browse Issues &amp; Pull Requests</title>
</head>
<body>
  <div layout:fragment="header">Browse Issues &amp; Pull Requests</div>

  <div layout:fragment="contents">

    <button class="ui button fluid labeled icon primary modalable">
      <i class="icon search"></i>edit search condition
    </button>

    <form method="POST" th:action="@{/issues}" th:object="${query}" class="ui fullscreen modal">
      <div class="header">Please input search condition.</div>
      <div class="content">
        <div class="ui form">
          <h4 class="ui dividing header">Organization/Repository</h4>
          <div class="four fields">
            <div th:include="components/fields::text('org', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('repo', 'user')" th:remove="tag"></div>
          </div>
          <h4 class="ui dividing header">Users</h4>
          <div class="four fields">
            <div th:include="components/fields::text('author', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('assignee', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('mentions', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('commenter', 'user')" th:remove="tag"></div>
          </div>
          <div class="four fields">
            <div th:include="components/fields::text('involves', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('reviewedBy', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('reviewRequested', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::text('team', 'user')" th:remove="tag"></div>
          </div>
          <h4 class="ui dividing header">Categories/States</h4>
          <div class="four fields">
            <div th:include="components/fields::select('type', '@type', 'linkify')" th:remove="tag"></div>
            <div th:include="components/fields::text('label', 'user')" th:remove="tag"></div>
            <div th:include="components/fields::select('is', '@is', 'linkify')" th:remove="tag"></div>
            <div th:include="components/fields::select('review', '@review', 'linkify')" th:remove="tag"></div>
          </div>
          <div class="four fields">
            <div th:include="components/fields::select('in', '@in', 'linkify')" th:remove="tag"></div>
            <div th:include="components/fields::text('value', 'user')" th:remove="tag"></div>
          </div>
          <h4 class="ui dividing header">Order Results</h4>
          <div class="four fields" th:object="${order}">
            <div th:include="components/fields::select('sort', '@sort', 'linkify')" th:remove="tag"></div>
            <div th:include="components/fields::select('order', '@order', 'linkify')" th:remove="tag"></div>
          </div>
          <div class="ui fluid buttons">
            <button type="reset" class="ui button labeled icon">
              <i class="icon remove"></i>reset
            </button>
            <div class="or"></div>
            <button type="submit" class="ui button labeled icon primary">
              <i class="icon search"></i>search
            </button>
          </div>
        </div>
      </div>
    </form>

    <script type="text/javascript">
          $('.modalable').on(
              'click',
              function() {
                $('.ui.modal').modal('setting', 'transition', 'slide down')
                    .modal('show');
              });
          $('button[type="submit"]').on('click', function() {
            $('.form').addClass("loading");
          });
        </script>

    <div th:switch="${issues == null}">
      <div th:case="true">
        <script type="text/javascript">
                  $('.modalable').click();
                </script>
      </div>
      <div th:case="*">
        <div class="ui message positive">
          <i class="icon close"></i>
          <div class="header">Search issues completed!</div>
          <p th:text="|Getting ${#lists.size(issues)} issues / pull requests.|"></p>
        </div>

        <table class="ui selectable celled table">
          <thead>
            <tr>
              <th>Issue</th>
              <th>Labels</th>
              <th>Milestone</th>
              <th>State</th>
              <th>Assignees</th>
            </tr>
          </thead>
          <tbody th:each="issue : ${issues}" th:remove="all-but-first">
            <tr>
              <td><a th:href="${issue.htmlUrl}">
                  <div class="ui ribbon label">
                    <span th:text="|${issue.repository}#${issue.number}|"></span>
                  </div>
                  <span th:text="${issue.title}"></span>
                  <div class="ui label">
                    <i class="icon comments"></i><span th:text="${issue.comments}"></span>
                  </div>
                </a></td>
              <td>
                <div class="ui tag labels">
                  <a class="ui label" th:each="label : ${issue.labels}"
                    th:style="|background-color: ${label.colorCode}|" th:href="${label.htmlUrl}" th:text="${label.name}"></a>
                </div>
              </td>
              <td th:with="milestone=${issue.milestone}">
                <div th:if="${milestone != null}">
                  <i class="icon wait"></i>
                  <a th:href="${milestone.htmlUrl}" th:text="${milestone.title}"></a>
                </div>
              </td>
              <td>
                <div th:switch="${issue.state == 'closed'}">
                  <div th:case="true">
                    <div class="ui label blue">
                      <i class="icon checkmark"></i><span th:text="${issue.state}"></span>
                    </div>
                  </div>
                  <div th:case="*">
                    <div class="ui label red">
                      <i class="icon bomb"></i><span th:text="${issue.state}"></span>
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <div th:each="assignee : ${issue.assignees}">
                  <i class="icon user"></i>
                  <a th:href="${assignee.htmlUrl}" th:text="${assignee.login}"></a>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <script type="text/javascript">
                  $('.message .close').on('click', function() {
                    $(this).closest('.message').transition('fade');
                  });
                </script>
      </div>
    </div>
  </div>
</body>
</html>